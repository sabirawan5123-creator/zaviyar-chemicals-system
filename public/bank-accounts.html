<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash & Bank - Zaviyar Chemicals</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #e8edf2 100%); min-height: 100vh; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .header { background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); padding: 24px 40px; box-shadow: 0 4px 20px rgba(20, 184, 166, 0.3); display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; animation: fadeIn 0.5s ease-out; }
        .header h1 { color: white; font-size: 28px; font-weight: 800; letter-spacing: -0.5px; display: flex; align-items: center; gap: 12px; }
        .header h1::before { content: 'üè¶'; font-size: 32px; }
        .header-actions { display: flex; gap: 15px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .container { padding: 0 30px 30px; max-width: 1400px; margin: 0 auto; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .summary-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .summary-card h3 { color: #6b7280; font-size: 12px; text-transform: uppercase; margin-bottom: 8px; }
        .summary-card p { color: #1f2937; font-size: 28px; font-weight: 700; }
        .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card h2 { color: #1f2937; margin-bottom: 20px; font-size: 18px; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: #f9fafb; }
        th { padding: 12px; text-align: left; font-size: 12px; font-weight: 700; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb; }
        td { padding: 12px; border-bottom: 1px solid #e5e7eb; color: #1f2937; }
        tr:hover { background: #f9fafb; }
        .badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-primary { background: #dbeafe; color: #1e3a8a; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; margin: 20px auto; }
        
        /* Custom Scrollbar */
        .modal-content::-webkit-scrollbar { width: 8px; }
        .modal-content::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
        .modal-content::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .modal-content::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { color: #1f2937; font-size: 20px; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #374151; font-weight: 600; font-size: 14px; }
        .form-group input, .form-group select { width: 100%; padding: 12px 16px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px; color: #1f2937; font-weight: 600; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .loading { text-align: center; padding: 40px; color: #6b7280; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6b7280; }
        
        /* RESPONSIVE DESIGN */
        @media (max-width: 1024px) { .modal-content { max-width: 700px; padding: 25px; max-height: 85vh; overflow-y: auto; } .form-row { gap: 12px; } }
        @media (max-width: 768px) { .modal-content { max-width: 95%; width: 95%; padding: 20px; margin: 10px auto; max-height: 85vh; overflow-y: auto; } .modal-header h2 { font-size: 18px; } .close-btn { font-size: 28px; } .form-row { grid-template-columns: 1fr; gap: 10px; } .form-group { margin-bottom: 16px; } .form-group label { font-size: 13px; margin-bottom: 6px; } .form-group input, .form-group select, .form-group textarea { padding: 10px 14px; font-size: 14px; } .btn { padding: 12px 18px; font-size: 13px; } .header { padding: 18px 20px; flex-direction: column; gap: 12px; align-items: flex-start; } .header h1 { font-size: 22px; } .header-actions { width: 100%; flex-direction: column; gap: 10px; } .header-actions .btn { width: 100%; } .container { padding: 0 15px 15px; } }
        @media (max-width: 480px) { .modal-content { width: calc(100% - 20px); height: auto; max-height: 95vh; max-width: 100%; border-radius: 8px; padding: 15px; margin: 10px auto; overflow-y: auto; } .modal-header { margin-bottom: 15px; padding-bottom: 12px; border-bottom: 2px solid #e5e7eb; position: sticky; top: 0; background: white; z-index: 10; } .modal-header h2 { font-size: 16px; } .close-btn { font-size: 32px; padding: 0; min-width: 32px; } .form-group { margin-bottom: 14px; } .form-group label { font-size: 12px; margin-bottom: 6px; } .form-group input, .form-group select, .form-group textarea { padding: 10px 12px; font-size: 13px; } .btn { padding: 10px 16px; font-size: 13px; } .header { padding: 15px; } .header h1 { font-size: 18px; } .header h1::before { font-size: 24px; } .container { padding: 0 10px 10px; } .card { padding: 15px; border-radius: 8px; } table { font-size: 12px; } th, td { padding: 8px 6px; } th { font-size: 10px; } }
        @media (max-width: 360px) { .modal-content { padding: 12px; width: calc(100% - 10px); margin: 5px auto; max-height: 98vh; } .modal-header h2 { font-size: 15px; } .form-group label { font-size: 11px; } .form-group input, .form-group select, .form-group textarea { padding: 8px 10px; font-size: 12px; } .btn { padding: 8px 14px; font-size: 12px; } .header h1 { font-size: 16px; } table { font-size: 11px; } th, td { padding: 6px 4px; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>Cash & Bank Management</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="window.location.href='/dashboard.html'">Back to Dashboard</button>
            <button class="btn btn-primary" onclick="openAddAccountModal()">+ Add Account</button>
        </div>
    </div>

    <div class="container">
        <div class="summary-grid">
            <div class="summary-card">
                <h3>Cash in Hand</h3>
                <p style="color: #10b981;" id="cashTotal">$0.00</p>
            </div>
            <div class="summary-card">
                <h3>Total in Banks</h3>
                <p style="color: #3b82f6;" id="bankTotal">$0.00</p>
            </div>
            <div class="summary-card">
                <h3>Total Available</h3>
                <p id="totalAvailable">$0.00</p>
            </div>
        </div>

        <div class="card">
            <h2>Bank Accounts</h2>
            <div id="accountsList">
                <div class="loading">Loading accounts...</div>
            </div>
        </div>
    </div>

    <!-- Add Account Modal -->
    <div id="accountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">üè¶ Add Bank Account</h2>
                <button class="close-btn" onclick="closeModal()" title="Close (Esc)">&times;</button>
            </div>
            <form id="accountForm" onsubmit="saveAccount(event)">
                <input type="hidden" id="accountId">
                
                <!-- Account Type Section -->
                <div style="background: #d1fae5; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #065f46; font-size: 16px; margin-bottom: 15px; font-weight: 700;">üè∑Ô∏è Account Type</h3>
                    <div class="form-group">
                        <label>Type <span style="color: #ef4444;">*</span></label>
                        <select id="accountType" required>
                            <option value="">-- Select Type --</option>
                            <option value="cash">üíµ Cash in Hand</option>
                            <option value="bank">üè¶ Bank Account</option>
                        </select>
                        <small style="color: #64748b; font-size: 12px; margin-top: 4px; display: block;">Is this cash or a bank account?</small>
                    </div>
                </div>

                <!-- Account Info Section -->
                <div style="background: #dbeafe; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #1e40af; font-size: 16px; margin-bottom: 15px; font-weight: 700;">üìù Account Information</h3>
                    <div class="form-group">
                        <label>Account Name <span style="color: #ef4444;">*</span></label>
                        <input type="text" id="accountName" required placeholder="e.g., Main Cash, Meezan Bank Current Account">
                        <small style="color: #64748b; font-size: 12px; margin-top: 4px; display: block;">Descriptive name for this account</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>üè¶ Bank Name</label>
                            <input type="text" id="bankName" placeholder="e.g., Meezan Bank, HBL, UBL">
                            <small style="color: #64748b; font-size: 12px; margin-top: 4px; display: block;">Bank name (for bank accounts)</small>
                        </div>
                        <div class="form-group">
                            <label>üî¢ Account Number</label>
                            <input type="text" id="accountNumber" placeholder="XXXX-XXXX-XXXX">
                            <small style="color: #64748b; font-size: 12px; margin-top: 4px; display: block;">Bank account number</small>
                        </div>
                    </div>
                </div>

                <!-- Balance Section -->
                <div style="background: #fef3c7; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #b45309; font-size: 16px; margin-bottom: 15px; font-weight: 700;">üí∞ Current Balance</h3>
                    <div class="form-group">
                        <label>Balance (Rs.) <span style="color: #ef4444;">*</span></label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #6b7280; font-weight: 600;">Rs.</span>
                            <input type="number" id="balance" step="0.01" required value="0" placeholder="0.00" style="padding-left: 45px;">
                        </div>
                        <small style="color: #64748b; font-size: 12px; margin-top: 4px; display: block;">Current balance in this account</small>
                    </div>
                </div>

                <!-- Notes Section -->
                <div class="form-group" style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <label>üìù Notes</label>
                    <textarea id="notes" rows="2" placeholder="Additional information or notes about this account..." style="resize: vertical;"></textarea>
                    <small style="color: #64748b; font-size: 12px; margin-top: 4px; display: block;">Optional: Add any relevant details</small>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 20px; border-top: 2px solid #e5e7eb;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()" style="padding: 14px 28px; font-size: 15px;">
                        ‚ùå Cancel
                    </button>
                    <button type="submit" class="btn btn-success" id="saveBtn" style="padding: 14px 32px; font-size: 15px; font-weight: 700; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);">
                        ‚úÖ Save Account
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('token');
        if (!token) window.location.href = '/login.html';

        let accounts = [];
        loadAccounts();

        async function loadAccounts() {
            try {
                const response = await fetch('/api/bank-accounts', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to load accounts');
                const result = await response.json();
                accounts = result.data || [];
                displayAccounts(accounts);
                calculateSummary();
            } catch (error) {
                document.getElementById('accountsList').innerHTML = '<div class="error">Failed to load accounts</div>';
            }
        }

        function calculateSummary() {
            const cashAccounts = accounts.filter(a => a.accountType === 'cash');
            const bankAccounts = accounts.filter(a => a.accountType === 'bank');
            
            const cashTotal = cashAccounts.reduce((sum, a) => sum + a.balance, 0);
            const bankTotal = bankAccounts.reduce((sum, a) => sum + a.balance, 0);
            
            document.getElementById('cashTotal').textContent = `$${cashTotal.toFixed(2)}`;
            document.getElementById('bankTotal').textContent = `$${bankTotal.toFixed(2)}`;
            document.getElementById('totalAvailable').textContent = `$${(cashTotal + bankTotal).toFixed(2)}`;
        }

        function displayAccounts(accountsToShow) {
            const container = document.getElementById('accountsList');
            
            if (accountsToShow.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No accounts found</h3><p>Add your first cash or bank account</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Type</th><th>Account Name</th><th>Bank</th><th>Account Number</th><th>Balance</th><th>Actions</th></tr></thead><tbody>';
            
            accountsToShow.forEach(account => {
                const typeBadge = account.accountType === 'cash' ? 'success' : 'primary';
                const typeLabel = account.accountType === 'cash' ? 'CASH' : 'BANK';
                
                html += `<tr>
                    <td><span class="badge badge-${typeBadge}">${typeLabel}</span></td>
                    <td><strong>${account.accountName}</strong></td>
                    <td>${account.bankName || '-'}</td>
                    <td>${account.accountNumber || '-'}</td>
                    <td><strong>$${account.balance.toFixed(2)}</strong></td>
                    <td>
                        <button class="btn btn-primary" onclick='editAccount(${JSON.stringify(account)})'>Edit</button>
                        <button class="btn btn-danger" onclick="deleteAccount(${account.id})">Delete</button>
                    </td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function openAddAccountModal() {
            document.getElementById('modalTitle').textContent = 'Add Bank Account';
            document.getElementById('accountForm').reset();
            document.getElementById('accountId').value = '';
            document.getElementById('accountModal').classList.add('active');
        }

        function editAccount(account) {
            document.getElementById('modalTitle').textContent = 'Edit Account';
            document.getElementById('accountId').value = account.id;
            document.getElementById('accountType').value = account.accountType;
            document.getElementById('accountName').value = account.accountName;
            document.getElementById('accountNumber').value = account.accountNumber || '';
            document.getElementById('balance').value = account.balance;
            document.getElementById('bankName').value = account.bankName || '';
            document.getElementById('notes').value = account.notes || '';
            document.getElementById('accountModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('accountModal').classList.remove('active');
        }

        async function saveAccount(event) {
            event.preventDefault();
            
            const id = document.getElementById('accountId').value;
            const data = {
                accountType: document.getElementById('accountType').value,
                accountName: document.getElementById('accountName').value,
                accountNumber: document.getElementById('accountNumber').value,
                balance: parseFloat(document.getElementById('balance').value),
                bankName: document.getElementById('bankName').value,
                notes: document.getElementById('notes').value
            };

            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
                const url = id ? `/api/bank-accounts/${id}` : '/api/bank-accounts';
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) throw new Error('Failed to save account');
                
                closeModal();
                loadAccounts();
                alert(id ? 'Account updated!' : 'Account added!');
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Account';
            }
        }

        async function deleteAccount(id) {
            if (!confirm('Delete this account?')) return;
            
            try {
                const response = await fetch(`/api/bank-accounts/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Failed to delete');
                
                loadAccounts();
                alert('Account deleted!');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>

